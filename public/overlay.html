<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Klipper Overlay</title>
  <link rel="icon" href="/favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="/overlay.css">
</head>
<body>
  <div class="app">
    <!-- Status Header -->
    <div class="status-bar">
      <div class="status-pill" id="connection-status">
        <svg class="pulse-dot" width="8" height="8"><circle cx="4" cy="4" r="4" fill="currentColor"/></svg>
        <span id="status-label">Connecté</span>
      </div>
    </div>

    <!-- Print Status -->
    <section class="card">
      <div class="card-header">
        <div class="state-badge" id="state-badge" data-state="idle">
          <svg class="state-icon" id="state-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2"/>
          </svg>
          <span id="state-text">Inactif</span>
        </div>
      </div>
      <div class="card-content">
        <div class="print-info">
          <img id="thumbnail" class="thumbnail" style="display: none;" alt="Preview">
          <div class="filename" id="filename">Aucune impression</div>
        </div>
      </div>
    </section>

    <!-- Progress -->
    <section class="card">
      <div class="progress-header">
        <span class="progress-label">Progression</span>
        <span class="progress-value" id="progress-value">0%</span>
      </div>
      <div class="progress-track">
        <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
      </div>
      <div class="time-grid">
        <div class="time-item">
          <span class="time-label">Écoulé</span>
          <span class="time-value" id="duration">00:00</span>
        </div>
        <div class="time-item">
          <span class="time-label">Restant</span>
          <span class="time-value" id="remaining">--:--</span>
        </div>
      </div>
    </section>

    <!-- Temperatures -->
    <section class="card">
      <div class="card-header">
        <span>Températures</span>
      </div>
      <div class="temps-grid">
        <!-- Nozzle -->
        <div class="temp-card">
          <svg class="temp-icon nozzle" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
          </svg>
          <div class="temp-info">
            <div class="temp-label">Buse</div>
            <div class="temp-values">
              <span class="temp-current" id="extruder-temp">0</span>°
              <span class="temp-sep">/</span>
              <span class="temp-target" id="extruder-target">0</span>°
            </div>
          </div>
          <svg class="temp-ring" width="60" height="60">
            <circle class="ring-bg" cx="30" cy="30" r="24" fill="none" stroke="currentColor" stroke-width="4" opacity="0.1"/>
            <circle class="ring-progress" id="nozzle-ring" cx="30" cy="30" r="24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" 
              stroke-dasharray="150.8" stroke-dashoffset="150.8" transform="rotate(-90 30 30)"/>
          </svg>
        </div>

        <!-- Bed -->
        <div class="temp-card">
          <svg class="temp-icon bed" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 2L2 7v10l10 5 10-5V7z"/>
            <polyline points="2 17 12 22 22 17"/>
            <polyline points="2 12 12 17 22 12"/>
          </svg>
          <div class="temp-info">
            <div class="temp-label">Plateau</div>
            <div class="temp-values">
              <span class="temp-current" id="bed-temp">0</span>°
              <span class="temp-sep">/</span>
              <span class="temp-target" id="bed-target">0</span>°
            </div>
          </div>
          <svg class="temp-ring" width="60" height="60">
            <circle class="ring-bg" cx="30" cy="30" r="24" fill="none" stroke="currentColor" stroke-width="4" opacity="0.1"/>
            <circle class="ring-progress" id="bed-ring" cx="30" cy="30" r="24" fill="none" stroke="currentColor" stroke-width="4" stroke-linecap="round" 
              stroke-dasharray="150.8" stroke-dashoffset="150.8" transform="rotate(-90 30 30)"/>
          </svg>
        </div>
      </div>
    </section>

    <!-- Footer -->
    <div class="footer">
      <button class="btn-stats" id="stats-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/>
        </svg>
        <span>Statistiques</span>
      </button>
      <button class="btn-stats" id="light-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
        </svg>
        <span>Lumière</span>
      </button>
      <span id="last-update">--:--:--</span>
    </div>
  </div>

  <!-- Stats Modal -->
  <div id="stats-modal" class="modal hidden">
    <div class="modal-backdrop" id="stats-backdrop"></div>
    <div class="modal-panel modal-small">
      <div class="modal-header">
        <h2>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
            <line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/>
          </svg>
          Statistiques
        </h2>
        <button class="btn-icon" id="stats-close" aria-label="Fermer">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="stats-grid-modal">
          <div class="stat-large">
            <div class="stat-value" id="stat-total">0</div>
            <div class="stat-label">Total</div>
          </div>
          <div class="stat-large">
            <div class="stat-value" id="stat-success">0%</div>
            <div class="stat-label">Réussite</div>
          </div>
          <div class="stat-large">
            <div class="stat-value" id="stat-completed">0</div>
            <div class="stat-label">Complété</div>
          </div>
          <div class="stat-large">
            <div class="stat-value" id="stat-time">0h</div>
            <div class="stat-label">Temps Total</div>
          </div>
        </div>
        <button class="btn-secondary" id="view-history">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/>
            <line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>
          </svg>
          Voir l'historique
        </button>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div id="history-modal" class="modal hidden">
    <div class="modal-backdrop" id="history-backdrop"></div>
    <div class="modal-panel">
      <div class="modal-header">
        <h2>
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: middle; margin-right: 8px;">
            <line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/>
            <line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/>
          </svg>
          Historique
        </h2>
        <button class="btn-icon" id="history-close" aria-label="Fermer">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body" id="history-list">
        <!-- Dynamic content -->
      </div>
    </div>
  </div>

  <!-- Thumbnail Fullscreen Modal -->
  <div class="thumbnail-modal" id="thumbnail-modal" style="display: none;">
    <div class="thumbnail-backdrop" id="thumbnail-backdrop"></div>
    <img id="thumbnail-fullscreen" class="thumbnail-fullscreen" alt="Preview">
  </div>

  <script src="/overlay.js"></script>
</body>
</html>
